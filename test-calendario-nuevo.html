<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test Calendario - Verificaci√≥n Ensayo General</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        .test-section h3 {
            color: #333;
            margin-top: 0;
        }
        .debug-output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 12px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .day-test {
            display: inline-block;
            margin: 5px;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            min-width: 100px;
            text-align: center;
        }
        .day-correct { background: #d4edda; border-color: #c3e6cb; }
        .day-incorrect { background: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test del Nuevo Sistema de Calendario</h1>
        <p><strong>Objetivo:</strong> Verificar que "Ensayo General" NO aparezca los domingos</p>
        
        <div class="test-section">
            <h3>üìã Test de D√≠as de la Semana</h3>
            <div id="dayMappingTest"></div>
        </div>

        <div class="test-section">
            <h3>üé≠ Test de Clase "Ensayo General"</h3>
            <div id="ensayoGeneralTest"></div>
        </div>

        <div class="test-section">
            <h3>üìÖ Test de Fecha Espec√≠fica (2025-07-06 Domingo)</h3>
            <div id="specificDateTest"></div>
        </div>

        <div class="test-section">
            <h3>üîç Debug Completo</h3>
            <div class="debug-output" id="debugOutput"></div>
        </div>
    </div>

    <script>
        // Simulamos el CalendarService y las funciones principales
        const CalendarService = {
            getDayOfWeek(date) {
                return date.getDay(); // JavaScript: 0=domingo, 1=lunes, etc.
            },

            isClassScheduledForDay(classItem, dayOfWeek) {
                if (!classItem || !classItem.diasSemana) {
                    return false;
                }
                
                // Mapear d√≠as en espa√±ol a n√∫meros JavaScript
                const dayMapping = {
                    'domingo': 0,
                    'lunes': 1,
                    'martes': 2,
                    'mi√©rcoles': 3,
                    'jueves': 4,
                    'viernes': 5,
                    's√°bado': 6
                };
                
                return classItem.diasSemana.some(dia => {
                    const dayNumber = dayMapping[dia.toLowerCase()];
                    return dayNumber === dayOfWeek;
                });
            }
        };

        // Datos de prueba - "Ensayo General"
        const ensayoGeneralClass = {
            id: 'ensayo-general-1',
            nombre: 'Ensayo General',
            diasSemana: ['martes', 'jueves', 's√°bado'], // NO incluye domingo
            horaInicio: '19:00',
            horaFin: '21:00'
        };

        // Test 1: Mapeo de d√≠as
        function testDayMapping() {
            const days = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];
            const expectedNumbers = [0, 1, 2, 3, 4, 5, 6];
            let html = '<p>Verificando mapeo de d√≠as:</p>';
            
            const dayMapping = {
                'domingo': 0, 'lunes': 1, 'martes': 2, 'mi√©rcoles': 3,
                'jueves': 4, 'viernes': 5, 's√°bado': 6
            };
            
            days.forEach((day, index) => {
                const mapped = dayMapping[day];
                const expected = expectedNumbers[index];
                const isCorrect = mapped === expected;
                
                html += `<div class="day-test ${isCorrect ? 'day-correct' : 'day-incorrect'}">
                    ${day}: ${mapped} ${isCorrect ? '‚úÖ' : '‚ùå'}
                </div>`;
            });
            
            return html;
        }

        // Test 2: Ensayo General en cada d√≠a
        function testEnsayoGeneral() {
            const days = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];
            const dayNumbers = [0, 1, 2, 3, 4, 5, 6];
            let html = '<p>Verificando "Ensayo General" por d√≠a:</p>';
            
            dayNumbers.forEach((dayNum, index) => {
                const dayName = days[index];
                const shouldShow = CalendarService.isClassScheduledForDay(ensayoGeneralClass, dayNum);
                const expected = ['martes', 'jueves', 's√°bado'].includes(dayName);
                const isCorrect = shouldShow === expected;
                
                html += `<div class="day-test ${isCorrect ? 'day-correct' : 'day-incorrect'}">
                    ${dayName} (${dayNum}): ${shouldShow ? 'S√ç' : 'NO'} ${isCorrect ? '‚úÖ' : '‚ùå'}
                </div>`;
            });
            
            return html;
        }

        // Test 3: Fecha espec√≠fica problem√°tica
        function testSpecificDate() {
            const problemDate = new Date('2025-07-06'); // Domingo que causaba problemas
            const dayOfWeek = CalendarService.getDayOfWeek(problemDate);
            const shouldShow = CalendarService.isClassScheduledForDay(ensayoGeneralClass, dayOfWeek);
            
            let html = `
                <p><strong>Fecha:</strong> ${problemDate.toLocaleDateString('es-ES', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                })}</p>
                <p><strong>D√≠a de la semana (n√∫mero):</strong> ${dayOfWeek}</p>
                <p><strong>¬øDebe mostrar "Ensayo General"?:</strong> 
                   <span class="${shouldShow ? 'error' : 'success'}">
                       ${shouldShow ? 'S√ç ‚ùå (ERROR!)' : 'NO ‚úÖ (CORRECTO!)'}
                   </span>
                </p>
            `;
            
            return html;
        }

        // Debug completo
        function generateDebugInfo() {
            const testDate = new Date('2025-07-06');
            const dayOfWeek = testDate.getDay();
            
            return `DIAGN√ìSTICO COMPLETO - NUEVO SISTEMA DE CALENDARIO
===============================================

üìÖ FECHA DE PRUEBA: ${testDate.toISOString()}
üóìÔ∏è  D√≠a de la semana: ${dayOfWeek} (${['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'][dayOfWeek]})

üé≠ CLASE: "Ensayo General"
üìã D√≠as programados: ${ensayoGeneralClass.diasSemana.join(', ')}
üïê Horario: ${ensayoGeneralClass.horaInicio} - ${ensayoGeneralClass.horaFin}

üîç VERIFICACI√ìN:
- ¬øEs domingo (0)? ${dayOfWeek === 0 ? 'S√ç' : 'NO'}
- ¬øEst√° "domingo" en diasSemana? ${ensayoGeneralClass.diasSemana.includes('domingo') ? 'S√ç' : 'NO'}
- ¬øDebe mostrar la clase? ${CalendarService.isClassScheduledForDay(ensayoGeneralClass, dayOfWeek) ? 'S√ç ‚ùå' : 'NO ‚úÖ'}

‚úÖ RESULTADO: ${CalendarService.isClassScheduledForDay(ensayoGeneralClass, dayOfWeek) ? 'FALLO - La clase aparece en domingo' : '√âXITO - La clase NO aparece en domingo'}

üèóÔ∏è ARQUITECTURA UTILIZADA:
- Service Layer: CalendarService.js
- Clean Architecture: Separaci√≥n de responsabilidades
- TypeScript: Tipado estricto
- Mapeo directo: espa√±ol ‚Üí JavaScript day numbers
- Sin conversiones confusas ni offsets extra√±os

üìä D√çAS DE PRUEBA ADICIONALES:
${[0,1,2,3,4,5,6].map(day => {
    const dayName = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'][day];
    const shows = CalendarService.isClassScheduledForDay(ensayoGeneralClass, day);
    return `- ${dayName} (${day}): ${shows ? 'S√ç' : 'NO'}`;
}).join('\n')}`;
        }

        // Ejecutar tests
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('dayMappingTest').innerHTML = testDayMapping();
            document.getElementById('ensayoGeneralTest').innerHTML = testEnsayoGeneral();
            document.getElementById('specificDateTest').innerHTML = testSpecificDate();
            document.getElementById('debugOutput').textContent = generateDebugInfo();
        });
    </script>
</body>
</html>
